<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Search Interface — Interactive Mockup</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      background: #f4f4f2;
      margin: 0;
      padding: 40px 24px 80px;
      color: #2c2c2c;
    }

    h1 {
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin: 0 0 8px;
      color: #888;
      text-transform: uppercase;
    }

    .page-note {
      font-size: 0.8rem;
      color: #bbb;
      margin-bottom: 48px;
    }

    .card {
      background: #fff;
      border-radius: 16px;
      padding: 28px 28px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.07);
      max-width: 720px;
    }

    /* ── Divider ── */
    .divider {
      border: none;
      border-top: 1px solid #ebebeb;
      margin: 20px 0;
    }

    /* ── Builder rows ── */
    .builder-rows {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .builder-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .field-select {
      font-family: 'Inter', sans-serif;
      font-size: 0.85rem;
      font-weight: 500;
      padding: 10px 14px;
      border: 1px solid #d0d0d0;
      border-radius: 50px;
      background: #f9f7f4;
      color: #2c2c2c;
      outline: none;
      min-width: 190px;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%23999' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 34px;
      cursor: pointer;
      transition: border-color 0.2s;
    }

    .field-select:focus {
      border-color: #2c2c2c;
    }

    .builder-input {
      flex: 1;
      font-family: 'Inter', sans-serif;
      font-size: 0.85rem;
      padding: 10px 16px;
      border: 1px solid #d0d0d0;
      border-radius: 50px;
      outline: none;
      color: #2c2c2c;
      transition: border-color 0.2s;
    }

    .builder-input::placeholder { color: #bbb; }

    .builder-input:focus {
      border-color: #2c2c2c;
    }

    .remove-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid #e0e0e0;
      background: #fff;
      color: #bbb;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
      transition: border-color 0.2s, color 0.2s;
      line-height: 1;
      padding: 0;
    }

    .remove-btn:hover {
      border-color: #2c2c2c;
      color: #2c2c2c;
    }

    .remove-btn:disabled {
      opacity: 0.25;
      cursor: default;
      pointer-events: none;
    }

    .remove-btn svg {
      display: block;
      flex-shrink: 0;
    }

    /* ── Bottom row: add + logic ── */
    .bottom-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 4px;
      padding-right: 38px;
    }

    .add-btn {
      font-family: 'Inter', sans-serif;
      font-size: 0.8rem;
      font-weight: 600;
      color: #2c2c2c;
      border: 1.5px dashed #d0d0d0;
      background: transparent;
      border-radius: 50px;
      padding: 8px 18px;
      cursor: pointer;
      transition: border-color 0.2s;
      white-space: nowrap;
    }

    .add-btn:hover { border-color: #2c2c2c; }

    .add-btn:disabled {
      opacity: 0.35;
      cursor: default;
      pointer-events: none;
    }

    .logic-section {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logic-between-label {
      font-size: 0.8rem;
      color: #bbb;
      font-weight: 600;
      line-height: 1;
      white-space: nowrap;
    }

    /* ── AND [slider] OR toggle ── */
    .site-logic-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .site-logic-label {
      font-family: 'Inter', sans-serif;
      font-size: 0.75rem;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: color 0.2s;
    }

    .site-logic-label.active { color: #2c2c2c; }

    .site-toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      cursor: pointer;
    }

    .site-toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
      position: absolute;
    }

    .site-toggle-slider {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: #2c2c2c;
      border-radius: 24px;
      transition: 0.3s;
    }

    .site-toggle-slider::before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: #fff;
      border-radius: 50%;
      transition: 0.3s;
    }

    .site-toggle-switch input:checked + .site-toggle-slider::before {
      transform: translateX(20px);
    }

    /* ── Active filters section ── */
    .active-filters-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .bottom-label {
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #bbb;
    }

    .clear-all {
      font-family: 'Inter', sans-serif;
      font-size: 0.78rem;
      font-weight: 600;
      color: #bbb;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      text-decoration: underline;
      text-underline-offset: 2px;
      transition: color 0.2s;
    }

    .clear-all:hover { color: #2c2c2c; }

    .dot-filter-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 7px 0;
      border-bottom: 1px solid #f0f0f0;
      font-size: 0.85rem;
    }

    .dot-filter-row:last-child { border-bottom: none; }

    .dot-label {
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      color: #bbb;
      min-width: 140px;
    }

    .dot-value {
      font-weight: 500;
      color: #2c2c2c;
      flex: 1;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 6px;
    }

    .filter-value-tag {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 0.8rem;
      font-weight: 500;
      padding: 4px 12px;
      border-radius: 50px;
      background: #2c2c2c;
      color: #fff;
    }

    .tag-x {
      font-size: 0.7rem;
      opacity: 0.55;
    }

    /* ── Empty state ── */
    .empty-filters {
      font-size: 0.82rem;
      color: #ccc;
      font-style: italic;
      padding: 4px 0;
    }

    /* ── Row enter animation ── */
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(-6px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .builder-row.new { animation: fadeSlideIn 0.2s ease; }

    /* ── Filters button (exact site style) ── */
    .filter-button {
      border-radius: 50px;
      padding: 10px 24px;
      font-family: 'Inter', sans-serif;
      font-size: 0.85rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
      background: #2c2c2c;
      color: #ffffff;
      border: none;
    }

    .filter-button:hover {
      background: #1a1a1a;
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0,0,0,0.2);
    }


    /* ── Filter panel ── */
    .filter-panel {
      display: none;
      flex-direction: column;
      gap: 0;
      animation: fadeSlideIn 0.2s ease;
    }

    .filter-panel.open { display: flex; }

    /* ── Segmented control (matching site style) ── */
    .seg-control {
      display: inline-flex;
      background: #f9f7f4;
      border: 1px solid #d0d0d0;
      border-radius: 50px;
      padding: 3px;
      gap: 3px;
    }

    .seg-btn {
      font-family: 'Inter', sans-serif;
      font-size: 0.82rem;
      font-weight: 500;
      padding: 6px 16px;
      border: none;
      border-radius: 50px;
      background: transparent;
      color: #666;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .seg-btn:hover { color: #2c2c2c; }

    .seg-btn.active {
      background: #2c2c2c;
      color: #fff;
      font-weight: 600;
    }

    /* ── Physical type accordion (mockup 5) ── */
    .phys-accordion {
      border-bottom: 1px solid #f0f0f0;
    }

    .phys-accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      cursor: pointer;
      user-select: none;
    }

    .phys-accordion-header:hover { opacity: 0.75; }

    .phys-chevron {
      color: #2c2c2c;
      flex-shrink: 0;
      transition: transform 0.3s ease;
    }

    .phys-accordion.expanded .phys-chevron {
      transform: rotate(180deg);
    }

    .phys-accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .phys-accordion.expanded .phys-accordion-content {
      max-height: 80px;
    }

    .phys-tag-x {
      font-size: 0.7rem;
      opacity: 0.55;
      cursor: pointer;
    }

    /* ── Mockup 6: split-click header ── */
    .phys-accordion-header.header-split {
      cursor: default;
      justify-content: flex-start;
    }

    .phys-accordion-header.header-split:hover {
      opacity: 1;
    }

    .phys-toggle-zone {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .phys-toggle-zone:hover { opacity: 0.75; }
  </style>
</head>
<body>

<h1>Search interface — interactive mockup</h1>
<p class="page-note">Click "+ Add field" to add search rows. Select a field, type a query, and remove rows with ×. The AND/OR toggle is functional.</p>

<!-- ── MOCKUP 1: search + active filters list ── -->
<div style="font-size:0.7rem; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; color:#aaa; margin-bottom:16px; padding-bottom:10px; border-bottom:1px solid #e0e0e0;">1 — Search fields + active filters list</div>

<div class="card" style="margin-bottom:40px;">
  <div class="builder-rows" id="builderRows1"></div>
  <div class="bottom-row" style="margin-top:14px;">
    <button class="add-btn" id="addFieldBtn1">+ Add field</button>
    <div class="logic-section" id="logicSection1" style="display:none;">
      <span class="logic-between-label">Logic between search fields:</span>
      <div class="site-logic-toggle">
        <span class="site-logic-label active" id="labelAnd1">AND</span>
        <label class="site-toggle-switch">
          <input type="checkbox" id="logicToggle1">
          <span class="site-toggle-slider"></span>
        </label>
        <span class="site-logic-label" id="labelOr1">OR</span>
      </div>
    </div>
  </div>
  <hr class="divider">
  <div class="active-filters-header">
    <div class="bottom-label">Active filters</div>
    <button class="clear-all" id="clearAllBtn1">Clear all</button>
  </div>
  <div id="activeFiltersList1">
    <div class="empty-filters">No filters active.</div>
  </div>
</div>

<!-- ── MOCKUP 2: search + Filters button only ── -->
<!-- kept as-is for comparison -->
<div style="font-size:0.7rem; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; color:#aaa; margin-bottom:16px; padding-bottom:10px; border-bottom:1px solid #e0e0e0;">2 — Search fields + Filters button</div>

<div class="card">
  <div class="builder-rows" id="builderRows2"></div>
  <div class="bottom-row" style="margin-top:14px;">
    <button class="add-btn" id="addFieldBtn2">+ Add field</button>
    <div class="logic-section" id="logicSection2" style="display:none;">
      <span class="logic-between-label">Logic between search fields:</span>
      <div class="site-logic-toggle">
        <span class="site-logic-label active" id="labelAnd2">AND</span>
        <label class="site-toggle-switch">
          <input type="checkbox" id="logicToggle2">
          <span class="site-toggle-slider"></span>
        </label>
        <span class="site-logic-label" id="labelOr2">OR</span>
      </div>
    </div>
  </div>
  <hr class="divider">
  <button style="font-family:'Inter',sans-serif; font-size:0.85rem; font-weight:600; background:#2c2c2c; color:#fff; border:none; border-radius:50px; padding:10px 24px; cursor:pointer;">Filters</button>
</div>

<!-- ── MOCKUP 3: copy of mockup 2 with SVG icons ── -->
<div style="font-size:0.7rem; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; color:#aaa; margin-bottom:16px; padding-bottom:10px; border-bottom:1px solid #e0e0e0; margin-top:40px;">3 — Search fields + Filters button (SVG icons)</div>

<div class="card">
  <div class="builder-rows" id="builderRows3"></div>
  <div class="bottom-row" style="margin-top:14px;">
    <button class="add-btn" id="addFieldBtn3">+ Add field</button>
    <div class="logic-section" id="logicSection3" style="display:none;">
      <span class="logic-between-label">Logic between search fields:</span>
      <div class="site-logic-toggle">
        <span class="site-logic-label active" id="labelAnd3">AND</span>
        <label class="site-toggle-switch">
          <input type="checkbox" id="logicToggle3">
          <span class="site-toggle-slider"></span>
        </label>
        <span class="site-logic-label" id="labelOr3">OR</span>
      </div>
    </div>
  </div>
  <hr class="divider">
  <button style="font-family:'Inter',sans-serif; font-size:0.85rem; font-weight:600; background:#2c2c2c; color:#fff; border:none; border-radius:50px; padding:10px 24px; cursor:pointer;">Filters</button>
</div>

<!-- ── MOCKUP 4: interactive Filters button ── -->
<div style="font-size:0.7rem; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; color:#aaa; margin-bottom:16px; padding-bottom:10px; border-bottom:1px solid #e0e0e0; margin-top:40px;">4 — Search fields + interactive Filters button</div>

<div class="card">
  <div class="builder-rows" id="builderRows4"></div>
  <div class="bottom-row" style="margin-top:14px;">
    <button class="add-btn" id="addFieldBtn4">+ Add field</button>
    <div class="logic-section" id="logicSection4" style="display:none;">
      <span class="logic-between-label">Logic between search fields:</span>
      <div class="site-logic-toggle">
        <span class="site-logic-label active" id="labelAnd4">AND</span>
        <label class="site-toggle-switch">
          <input type="checkbox" id="logicToggle4">
          <span class="site-toggle-slider"></span>
        </label>
        <span class="site-logic-label" id="labelOr4">OR</span>
      </div>
    </div>
  </div>
  <hr class="divider">

  <!-- Filters button (exact site style) -->
  <button class="filter-button" id="filtersBtn4">Filters</button>

  <!-- Filter panel (hidden until Filters is clicked) -->
  <div class="filter-panel" id="filterPanel4" style="margin-top:16px;">
    <div class="dot-filter-row">
      <span class="dot-label">Physical type</span>
      <span class="dot-value">
        <span class="filter-value-tag">Print <span class="tag-x">×</span></span>
      </span>
    </div>
  </div>
</div>

<!-- ── MOCKUP 5: interactive Filters + interactive physical type accordion ── -->
<div style="font-size:0.7rem; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; color:#aaa; margin-bottom:16px; padding-bottom:10px; border-bottom:1px solid #e0e0e0; margin-top:40px;">5 — Search fields + Filters button (interactive Physical type accordion)</div>

<div class="card">
  <div class="builder-rows" id="builderRows5"></div>
  <div class="bottom-row" style="margin-top:14px;">
    <button class="add-btn" id="addFieldBtn5">+ Add field</button>
    <div class="logic-section" id="logicSection5" style="display:none;">
      <span class="logic-between-label">Logic between search fields:</span>
      <div class="site-logic-toggle">
        <span class="site-logic-label active" id="labelAnd5">AND</span>
        <label class="site-toggle-switch">
          <input type="checkbox" id="logicToggle5">
          <span class="site-toggle-slider"></span>
        </label>
        <span class="site-logic-label" id="labelOr5">OR</span>
      </div>
    </div>
  </div>
  <hr class="divider">

  <!-- Filters button -->
  <button class="filter-button" id="filtersBtn5">Filters</button>

  <!-- Filter panel -->
  <div class="filter-panel" id="filterPanel5" style="margin-top:16px;">

    <!-- Physical type accordion -->
    <div class="phys-accordion" id="physAccordion5">
      <div class="phys-accordion-header" id="physHeader5">
        <span class="dot-label" style="color:#888; min-width:0;">Physical type</span>
        <span class="filter-value-tag" id="physTag5" style="display:none; margin-left:15px;">
          <span id="physTagText5"></span>
          <span class="phys-tag-x" id="physTagX5">×</span>
        </span>
        <svg class="phys-chevron" style="margin-left:auto;" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </div>
      <div class="phys-accordion-content">
        <div class="seg-control" style="margin: 4px 0 12px;">
          <button class="seg-btn active" data-val="Both">Both</button>
          <button class="seg-btn" data-val="Print">Print</button>
          <button class="seg-btn" data-val="Manuscript">Manuscript</button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ── MOCKUP 6: chevron next to title, value after chevron, split-click ── -->
<div style="font-size:0.7rem; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; color:#aaa; margin-bottom:16px; padding-bottom:10px; border-bottom:1px solid #e0e0e0; margin-top:40px;">6 — Chevron beside title · value after chevron · title+chevron area toggles accordion</div>

<div class="card">
  <div class="builder-rows" id="builderRows6"></div>
  <div class="bottom-row" style="margin-top:14px;">
    <button class="add-btn" id="addFieldBtn6">+ Add field</button>
    <div class="logic-section" id="logicSection6" style="display:none;">
      <span class="logic-between-label">Logic between search fields:</span>
      <div class="site-logic-toggle">
        <span class="site-logic-label active" id="labelAnd6">AND</span>
        <label class="site-toggle-switch">
          <input type="checkbox" id="logicToggle6">
          <span class="site-toggle-slider"></span>
        </label>
        <span class="site-logic-label" id="labelOr6">OR</span>
      </div>
    </div>
  </div>
  <hr class="divider">

  <button class="filter-button" id="filtersBtn6">Filters</button>

  <div class="filter-panel" id="filterPanel6" style="margin-top:16px;">
    <div class="phys-accordion" id="physAccordion6">

      <!-- Header: only the toggle zone (title + chevron) is clickable -->
      <div class="phys-accordion-header header-split">
        <div class="phys-toggle-zone" id="physToggleZone6">
          <span class="dot-label" style="color:#888; min-width:0;">Physical type</span>
          <svg class="phys-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
        <!-- Value tag: outside the clickable zone -->
        <span class="filter-value-tag" id="physTag6" style="display:none; margin-left:15px;">
          <span id="physTagText6"></span>
          <span class="phys-tag-x" id="physTagX6">×</span>
        </span>
      </div>

      <div class="phys-accordion-content">
        <div class="seg-control" style="margin: 4px 0 12px;">
          <button class="seg-btn active" data-val="Both">Both</button>
          <button class="seg-btn" data-val="Print">Print</button>
          <button class="seg-btn" data-val="Manuscript">Manuscript</button>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  const FIELDS = [
    'Title', 'Person', 'Place', 'Identifier',
    'Bibliography', 'Other metadata', 'Description / Comment', 'All fields'
  ];

  function escapeHtml(str) {
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  const SVG_X    = feather.icons['x'].toSvg({ width: 13, height: 13, 'stroke-width': 2 });
  const SVG_PLUS = feather.icons['plus'].toSvg({ width: 13, height: 13, 'stroke-width': 3 });

  // Inject feather plus into all add-field buttons
  document.querySelectorAll('.add-btn').forEach(btn => {
    btn.innerHTML = `${SVG_PLUS} Add field`;
    btn.style.display = 'inline-flex';
    btn.style.alignItems = 'center';
    btn.style.gap = '6px';
  });

  function createSearchWidget({ builderRowsId, addFieldBtnId, logicSectionId,
      logicToggleId, labelAndId, labelOrId, activeListId, clearAllBtnId, useSvgIcons = false }) {

    const builderRowsEl  = document.getElementById(builderRowsId);
    const addFieldBtnEl  = document.getElementById(addFieldBtnId);
    const logicSectionEl = document.getElementById(logicSectionId);
    const logicToggleEl  = document.getElementById(logicToggleId);
    const labelAndEl     = document.getElementById(labelAndId);
    const labelOrEl      = document.getElementById(labelOrId);
    const activeListEl   = activeListId ? document.getElementById(activeListId) : null;
    const clearAllBtnEl  = clearAllBtnId ? document.getElementById(clearAllBtnId) : null;

    let rows = [];
    let nextId = 0;

    function getDefaultField() {
      const used = new Set(rows.map(r => r.field));
      return FIELDS.find(f => !used.has(f)) || FIELDS[0];
    }

    function updateUI() {
      const count = rows.length;
      addFieldBtnEl.disabled = count >= FIELDS.length;
      builderRowsEl.querySelectorAll('.remove-btn').forEach(btn => {
        btn.disabled = count <= 1;
      });
      logicSectionEl.style.display = count >= 2 ? 'flex' : 'none';
    }

    function renderActiveFilters() {
      if (!activeListEl) return;
      const active = rows.filter(r => r.value.length > 0);
      if (active.length === 0) {
        activeListEl.innerHTML = '<div class="empty-filters">No filters active.</div>';
        return;
      }
      activeListEl.innerHTML = '';
      active.forEach(r => {
        const row = document.createElement('div');
        row.className = 'dot-filter-row';
        const label = document.createElement('span');
        label.className = 'dot-label';
        label.textContent = r.field;
        const valueWrap = document.createElement('span');
        valueWrap.className = 'dot-value';
        const tag = document.createElement('span');
        tag.className = 'filter-value-tag';
        tag.innerHTML = `${escapeHtml(r.value)} <span class="tag-x">×</span>`;
        tag.querySelector('.tag-x').addEventListener('click', () => {
          const inputEl = builderRowsEl.querySelector(`[data-id="${r.id}"] .builder-input`);
          if (inputEl) { inputEl.value = ''; inputEl.dispatchEvent(new Event('input')); }
        });
        valueWrap.appendChild(tag);
        row.appendChild(label);
        row.appendChild(valueWrap);
        activeListEl.appendChild(row);
      });
    }

    function removeRow(id) {
      rows = rows.filter(r => r.id !== id);
      const el = builderRowsEl.querySelector(`[data-id="${id}"]`);
      if (el) el.remove();
      updateUI();
      renderActiveFilters();
    }

    function addRow(field = '', value = '', animate = true) {
      const id = nextId++;
      const chosenField = field || getDefaultField();
      const rowObj = { id, field: chosenField, value };
      rows.push(rowObj);

      const div = document.createElement('div');
      div.className = 'builder-row' + (animate ? ' new' : '');
      div.dataset.id = id;

      const select = document.createElement('select');
      select.className = 'field-select';
      FIELDS.forEach(f => {
        const opt = document.createElement('option');
        opt.value = f; opt.textContent = f;
        if (f === chosenField) opt.selected = true;
        select.appendChild(opt);
      });
      select.addEventListener('change', () => { rowObj.field = select.value; renderActiveFilters(); });

      const input = document.createElement('input');
      input.className = 'builder-input';
      input.type = 'text';
      input.placeholder = 'Search…';
      input.value = value;
      input.addEventListener('input', () => { rowObj.value = input.value.trim(); renderActiveFilters(); });

      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      if (useSvgIcons) {
        removeBtn.innerHTML = SVG_X;
      } else {
        removeBtn.textContent = '×';
      }
      removeBtn.addEventListener('click', () => removeRow(id));

      div.appendChild(select);
      div.appendChild(input);
      div.appendChild(removeBtn);
      builderRowsEl.appendChild(div);

      updateUI();
      renderActiveFilters();
    }

    logicToggleEl.addEventListener('change', () => {
      if (logicToggleEl.checked) {
        labelAndEl.classList.remove('active');
        labelOrEl.classList.add('active');
      } else {
        labelAndEl.classList.add('active');
        labelOrEl.classList.remove('active');
      }
    });

    addFieldBtnEl.addEventListener('click', () => addRow());

    if (clearAllBtnEl) {
      clearAllBtnEl.addEventListener('click', () => {
        builderRowsEl.querySelectorAll('.builder-input').forEach(input => {
          input.value = '';
          input.dispatchEvent(new Event('input'));
        });
      });
    }

    addRow('Title', '', false);
    addRow('Person', '', false);
  }

  createSearchWidget({
    builderRowsId: 'builderRows1', addFieldBtnId: 'addFieldBtn1',
    logicSectionId: 'logicSection1', logicToggleId: 'logicToggle1',
    labelAndId: 'labelAnd1', labelOrId: 'labelOr1',
    activeListId: 'activeFiltersList1', clearAllBtnId: 'clearAllBtn1'
  });

  createSearchWidget({
    builderRowsId: 'builderRows2', addFieldBtnId: 'addFieldBtn2',
    logicSectionId: 'logicSection2', logicToggleId: 'logicToggle2',
    labelAndId: 'labelAnd2', labelOrId: 'labelOr2'
  });

  createSearchWidget({
    builderRowsId: 'builderRows3', addFieldBtnId: 'addFieldBtn3',
    logicSectionId: 'logicSection3', logicToggleId: 'logicToggle3',
    labelAndId: 'labelAnd3', labelOrId: 'labelOr3',
    useSvgIcons: true
  });

  createSearchWidget({
    builderRowsId: 'builderRows4', addFieldBtnId: 'addFieldBtn4',
    logicSectionId: 'logicSection4', logicToggleId: 'logicToggle4',
    labelAndId: 'labelAnd4', labelOrId: 'labelOr4',
    useSvgIcons: true
  });

  createSearchWidget({
    builderRowsId: 'builderRows5', addFieldBtnId: 'addFieldBtn5',
    logicSectionId: 'logicSection5', logicToggleId: 'logicToggle5',
    labelAndId: 'labelAnd5', labelOrId: 'labelOr5',
    useSvgIcons: true
  });

  /* ── Mockup 4: Filters button toggle ── */
  const filtersBtn4  = document.getElementById('filtersBtn4');
  const filterPanel4 = document.getElementById('filterPanel4');

  filtersBtn4.addEventListener('click', () => {
    filterPanel4.classList.toggle('open');
  });

  /* ── Mockup 5: Filters button + interactive physical type accordion ── */
  const filtersBtn5  = document.getElementById('filtersBtn5');
  const filterPanel5 = document.getElementById('filterPanel5');
  const physAccordion5 = document.getElementById('physAccordion5');
  const physHeader5    = document.getElementById('physHeader5');
  const physTag5       = document.getElementById('physTag5');
  const physTagText5   = document.getElementById('physTagText5');
  const physTagX5      = document.getElementById('physTagX5');
  const physSegBtns    = physAccordion5.querySelectorAll('.seg-btn');

  filtersBtn5.addEventListener('click', () => {
    filterPanel5.classList.toggle('open');
  });

  function setPhysValue5(val) {
    physSegBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.val === val));
    if (val === 'Both') {
      physTag5.style.display = 'none';
    } else {
      physTagText5.textContent = val;
      physTag5.style.display = 'inline-flex';
    }
  }

  physHeader5.addEventListener('click', (e) => {
    if (e.target.closest('#physTagX5')) return;
    physAccordion5.classList.toggle('expanded');
  });

  physSegBtns.forEach(btn => {
    btn.addEventListener('click', () => setPhysValue5(btn.dataset.val));
  });

  physTagX5.addEventListener('click', (e) => {
    e.stopPropagation();
    setPhysValue5('Both');
  });

  /* ── Mockup 6: split-click accordion ── */
  createSearchWidget({
    builderRowsId: 'builderRows6', addFieldBtnId: 'addFieldBtn6',
    logicSectionId: 'logicSection6', logicToggleId: 'logicToggle6',
    labelAndId: 'labelAnd6', labelOrId: 'labelOr6',
    useSvgIcons: true
  });

  const filtersBtn6    = document.getElementById('filtersBtn6');
  const filterPanel6   = document.getElementById('filterPanel6');
  const physAccordion6 = document.getElementById('physAccordion6');
  const physToggle6    = document.getElementById('physToggleZone6');
  const physTag6       = document.getElementById('physTag6');
  const physTagText6   = document.getElementById('physTagText6');
  const physTagX6      = document.getElementById('physTagX6');
  const physSegBtns6   = physAccordion6.querySelectorAll('.seg-btn');

  filtersBtn6.addEventListener('click', () => {
    filterPanel6.classList.toggle('open');
  });

  function setPhysValue6(val) {
    physSegBtns6.forEach(btn => btn.classList.toggle('active', btn.dataset.val === val));
    if (val === 'Both') {
      physTag6.style.display = 'none';
    } else {
      physTagText6.textContent = val;
      physTag6.style.display = 'inline-flex';
    }
  }

  physToggle6.addEventListener('click', () => {
    physAccordion6.classList.toggle('expanded');
  });

  physSegBtns6.forEach(btn => {
    btn.addEventListener('click', () => setPhysValue6(btn.dataset.val));
  });

  physTagX6.addEventListener('click', () => {
    setPhysValue6('Both');
  });
</script>

</body>
</html>
